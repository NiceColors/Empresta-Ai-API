generator client {
    provider        = "prisma-client-js"
    previewFeatures = ["referentialIntegrity"]
}

datasource db {
    provider             = "mysql"
    url                  = env("DATABASE_URL")
    referentialIntegrity = "prisma"
}

model Employee {
    id          String      @id @unique @default(uuid())
    email       String      @unique
    password    String
    UserToken   UserToken[]
    role        Role        @default(INTERN)
    permissions String
    name        String
    cpf         String      @unique
    birthdate   DateTime
    Loan        Loan[]
    createdAt   DateTime    @default(now())
    updatedAt   DateTime    @updatedAt
}

model Loan {
    id         String   @id @unique @default(uuid())
    value      Float
    employee   Employee @relation(fields: [employeeId], references: [id])
    employeeId String
    client     Client   @relation(fields: [clientId], references: [id])
    clientId   String
    status     Boolean  @default(false)
    book       Book     @relation(fields: [bookId], references: [id])
    bookId     String
    startDate  DateTime @default(now())
    endDate    DateTime
    bookFine   BookFine @relation(fields: [bookFineId], references: [id])
    bookFineId String
    createdAt  DateTime @default(now())
    updatedAt  DateTime @updatedAt
}

model UserToken {
    id           String   @id @default(uuid())
    employee     Employee @relation(fields: [employeeId], references: [id])
    employeeId   String
    refreshToken String   @db.Text()
    expires      DateTime
    createdAt    DateTime @default(now())
}

model Book {
    id          String   @id @unique @default(uuid())
    title       String
    author      String
    rent        Float
    synopsis    String
    pages       Int
    publisher   String
    isbn        String   @unique
    bannerUrl   String
    releaseYear DateTime @default(now())
    Loan        Loan[]
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt
}

model Client {
    id        String   @id @unique @default(uuid())
    name      String
    cpf       String   @unique
    birthdate DateTime
    Loan      Loan[]
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model BookFine {
    id         String   @id @unique @default(uuid())
    returnTime DateTime @default(now())
    value      Float
    Loan       Loan[]
    createdAt  DateTime @default(now())
    updatedAt  DateTime @updatedAt
}

enum Role {
    MANAGER
    INTERN
}
